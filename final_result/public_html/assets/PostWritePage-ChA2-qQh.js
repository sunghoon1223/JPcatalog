import{j as e}from"./ui-vendor-CPG2pbg2.js";import{u as V,r as o,f as X}from"./react-vendor-CUUEtbzt.js";import{c as G,a3 as K,f as h,a7 as L,a2 as J,C as S,d as k,e as P,a as B,L as v,I as w,r as O,s as Q,v as Y,w as Z,x as I,a5 as ee,a1 as q,T as se,X as ae,B as te,ah as M,ai as ne}from"./index-CSp23eor.js";import{U as re}from"./upload-Bp-XzxTY.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=G("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);function ie({board:n,post:a,mode:m="create",onSubmit:r,onCancel:j}){var T;const z=V(),{user:f}=K(),[g,b]=o.useState(!1),[_,y]=o.useState(!1),[s,p]=o.useState({title:(a==null?void 0:a.title)||"",content:(a==null?void 0:a.content)||"",post_type:(a==null?void 0:a.post_type)||"normal",is_pinned:(a==null?void 0:a.is_pinned)||!1,author_name:(a==null?void 0:a.author_name)||"",author_email:(a==null?void 0:a.author_email)||"",author_password:""}),[x,C]=o.useState([]),E=((T=f==null?void 0:f.user_metadata)==null?void 0:T.role)==="admin",u=!f,l=m==="edit";o.useEffect(()=>{a&&l&&p({title:a.title,content:a.content,post_type:a.post_type,is_pinned:a.is_pinned,author_name:a.author_name||"",author_email:a.author_email||"",author_password:""})},[a,l]);const c=()=>{j?j():z(`/board/${n.slug}`)},d=(t,i)=>{p(N=>({...N,[t]:i}))},A=t=>{const i=Array.from(t.target.files||[]),N=n.settings.max_attachment_size||10*1024*1024,D=i.filter(F=>F.size>N?(alert(`파일 크기가 너무 큽니다. 최대 ${Math.round(N/1024/1024)}MB까지 업로드 가능합니다.`),!1):!0);C(F=>[...F,...D])},U=t=>{C(i=>i.filter((N,D)=>D!==t))},$=async t=>{if(t.preventDefault(),!s.title.trim()||!s.content.trim()){alert("제목과 내용을 입력해주세요.");return}if(u&&(!s.author_name.trim()||!s.author_email.trim())){alert("익명 게시글의 경우 작성자 이름과 이메일을 입력해주세요.");return}b(!0);try{if(l){const i={title:s.title,content:s.content,post_type:s.post_type,is_pinned:s.is_pinned};await(r==null?void 0:r(i))}else{const i={board_id:n.id,title:s.title,content:s.content,post_type:s.post_type,is_pinned:s.is_pinned,author_name:u?s.author_name:void 0,author_email:u?s.author_email:void 0,author_password:u?s.author_password:void 0,attachments:x.length>0?x:void 0};await(r==null?void 0:r(i))}}finally{b(!1)}},W=t=>{switch(t){case"notice":return"공지";case"pinned":return"고정";default:return"일반"}},R=()=>e.jsxs(S,{children:[e.jsx(k,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.is_pinned&&e.jsx(q,{className:"h-4 w-4 text-red-500"}),s.post_type!=="normal"&&e.jsx(te,{variant:s.post_type==="notice"?"destructive":"secondary",children:W(s.post_type)}),e.jsx(P,{children:s.title||"제목을 입력하세요"})]})}),e.jsxs(B,{children:[e.jsx("div",{className:"prose prose-sm max-w-none whitespace-pre-wrap",dangerouslySetInnerHTML:{__html:s.content||"내용을 입력하세요"}}),x.length>0&&e.jsxs("div",{className:"mt-6 pt-4 border-t",children:[e.jsx("h4",{className:"font-medium mb-2",children:"첨부파일"}),e.jsx("ul",{className:"space-y-1",children:x.map((t,i)=>e.jsxs("li",{className:"text-sm text-gray-600",children:[t.name," (",Math.round(t.size/1024),"KB)"]},i))})]})]})]});return _?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(h,{variant:"ghost",size:"sm",onClick:()=>y(!1),children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"편집으로 돌아가기"]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(h,{onClick:$,disabled:g,children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),g?"저장 중...":l?"수정 완료":"게시글 작성"]})})]}),R()]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(h,{variant:"ghost",size:"sm",onClick:c,children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),n.name]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:l?"게시글 수정":"게시글 작성"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(h,{variant:"outline",onClick:()=>y(!0),disabled:!s.title.trim()||!s.content.trim(),children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"미리보기"]}),e.jsxs(h,{onClick:$,disabled:g,children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),g?"저장 중...":l?"수정 완료":"게시글 작성"]})]})]}),e.jsxs("form",{onSubmit:$,className:"space-y-6",children:[e.jsxs(S,{children:[e.jsx(k,{children:e.jsx(P,{children:"게시글 정보"})}),e.jsxs(B,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"title",children:"제목 *"}),e.jsx(w,{id:"title",value:s.title,onChange:t=>d("title",t.target.value),placeholder:"게시글 제목을 입력하세요",required:!0})]}),E&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"post_type",children:"게시글 유형"}),e.jsxs(O,{value:s.post_type,onValueChange:t=>d("post_type",t),children:[e.jsx(Q,{children:e.jsx(Y,{})}),e.jsxs(Z,{children:[e.jsx(I,{value:"normal",children:"일반 게시글"}),e.jsx(I,{value:"notice",children:"공지사항"}),e.jsx(I,{value:"pinned",children:"고정 게시글"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-8",children:[e.jsx(ee,{id:"is_pinned",checked:s.is_pinned,onCheckedChange:t=>d("is_pinned",t)}),e.jsxs(v,{htmlFor:"is_pinned",className:"flex items-center gap-1",children:[e.jsx(q,{className:"h-4 w-4"}),"상단 고정"]})]})]}),u&&n.settings.allow_anonymous&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"author_name",children:"작성자 이름 *"}),e.jsx(w,{id:"author_name",value:s.author_name,onChange:t=>d("author_name",t.target.value),placeholder:"이름을 입력하세요",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"author_email",children:"이메일 *"}),e.jsx(w,{id:"author_email",type:"email",value:s.author_email,onChange:t=>d("author_email",t.target.value),placeholder:"이메일을 입력하세요",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"author_password",children:"비밀번호 *"}),e.jsx(w,{id:"author_password",type:"password",value:s.author_password,onChange:t=>d("author_password",t.target.value),placeholder:"게시글 수정/삭제용 비밀번호",required:!0})]})]})]})]}),e.jsxs(S,{children:[e.jsx(k,{children:e.jsx(P,{children:"게시글 내용"})}),e.jsx(B,{children:e.jsx(se,{value:s.content,onChange:t=>d("content",t.target.value),placeholder:"게시글 내용을 입력하세요",rows:15,className:"resize-none",required:!0})})]}),n.settings.allow_attachments&&e.jsxs(S,{children:[e.jsx(k,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5"}),"첨부파일"]})}),e.jsxs(B,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(w,{type:"file",multiple:!0,onChange:A,className:"file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["최대 ",Math.round((n.settings.max_attachment_size||10*1024*1024)/1024/1024),"MB까지 업로드 가능합니다."]})]}),x.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium",children:"선택된 파일"}),x.map((t,i)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsxs("span",{className:"text-sm",children:[t.name," (",Math.round(t.size/1024),"KB)"]}),e.jsx(h,{type:"button",variant:"ghost",size:"sm",onClick:()=>U(i),children:e.jsx(ae,{className:"h-4 w-4"})})]},i))]})]})]})]})]})}function he(){const{boardSlug:n,postId:a}=X(),m=V(),{user:r}=K(),[j,z]=o.useState(null),[f,g]=o.useState(null),[b,_]=o.useState(!0),[y,s]=o.useState(null),p=!!a;o.useEffect(()=>{x()},[n,a]);const x=async()=>{var l;if(!n){s("게시판을 찾을 수 없습니다."),_(!1);return}try{_(!0),s(null);const c=await M.getBoard(n);if(!c){s("게시판을 찾을 수 없습니다.");return}if(z(c),p&&a){const d=await M.getPost(a);if(!d){s("게시글을 찾을 수 없습니다.");return}if(!(d.user_id===(r==null?void 0:r.id)||((l=r==null?void 0:r.user_metadata)==null?void 0:l.role)==="admin")){s("게시글을 수정할 권한이 없습니다.");return}g(d)}}catch(c){console.error("Data loading error:",c),s(c.message||"데이터를 불러오는데 실패했습니다.")}finally{_(!1)}},C=async l=>{if(j)try{if(p&&a)await M.updatePost(a,l),m(`/board/${n}/${a}`);else{const c=await M.createPost(l);m(`/board/${n}/${c.id}`)}}catch(c){console.error("Submit error:",c)}},E=()=>{m(p&&a?`/board/${n}/${a}`:`/board/${n}`)},u=()=>{m(`/board/${n}`)};return b?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(ne,{className:"mx-auto"})}):y||!j?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"오류 발생"}),e.jsx("p",{className:"text-gray-600 mb-6",children:y||"게시판을 찾을 수 없습니다."}),e.jsxs(h,{onClick:u,children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"게시판으로 돌아가기"]})]})}):!r&&!j.settings.allow_anonymous?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"로그인 필요"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"이 게시판에 글을 작성하려면 로그인이 필요합니다."}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx(h,{onClick:()=>m("/auth/login"),children:"로그인"}),e.jsx(h,{variant:"outline",onClick:u,children:"게시판으로 돌아가기"})]})]})}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(ie,{board:j,post:f||void 0,mode:p?"edit":"create",onSubmit:C,onCancel:E})})}export{he as default};
