import{j as e}from"./ui-vendor-D7YrltUJ.js";import{c as w,d as E,r as x}from"./react-vendor-XbLGo5ol.js";import{A as j}from"./AdminLayout-IQvitp-J.js";import{q as F,u as L,L as N,e as u,n as _,C as k,b as P,d as I,a as A,I as T,w as o,x as y}from"./index-iJ4ZFglL.js";import{L as h}from"./label-HICMNMR8.js";import{T as q}from"./textarea-Cxk_zgHe.js";import{S as D,a as V,b as z,c as B,d as f}from"./select-Dd79ptlA.js";import{C as H}from"./checkbox-C4Sv_fFD.js";import"./message-square-wSPTWZHd.js";import"./users-NOTXd2iJ.js";import"./index-BdQq_4o_.js";function Z(){const s=w(),{id:c}=E(),{user:m,loading:p}=F(),{t}=L(),[b,g]=x.useState(!0),[a,v]=x.useState(!1),[i,d]=x.useState({title:"",content:"",category:"general",is_pinned:!1});x.useEffect(()=>{(async()=>{if(!c){o.error(t("admin.notice.edit.toast.invalidId")),s("/admin/notices");return}if(!(p||!m)){g(!0);try{const r=(await y.getNotices({search:void 0})).notices.find(S=>S.id===c);if(!r){o.error(t("admin.notice.edit.toast.notFound")),s("/admin/notices");return}d({title:r.title,content:r.content,category:r.category,is_pinned:r.is_pinned||r.isPinned||!1})}catch(l){console.error("Failed to fetch notice:",l),o.error(t("admin.notice.edit.toast.loadError")),s("/admin/notices")}finally{g(!1)}}})()},[c,s,p,m]);const C=async n=>{if(n.preventDefault(),!!c){if(!m){o.error(t("admin.notice.sessionExpired.body")),s("/admin/login");return}v(!0);try{await y.updateNotice(c,{...i,isPinned:i.is_pinned}),o.success(t("admin.notice.edit.toast.success")),s("/admin/notices")}catch(l){console.error("Failed to update notice:",l),o.error(l.message||t("admin.notice.edit.toast.error"))}finally{v(!1)}}};return p||b?e.jsx(j,{children:e.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:e.jsx(N,{className:"h-8 w-8 animate-spin text-blue-600"})})}):m?e.jsx(j,{children:e.jsxs("div",{className:"space-y-6 max-w-4xl",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>s("/admin/notices"),children:e.jsx(_,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:t("admin.notice.edit.title")}),e.jsx("p",{className:"text-slate-600 mt-1",children:t("admin.notice.edit.subtitle")})]})]}),e.jsxs(k,{children:[e.jsx(P,{children:e.jsx(I,{children:t("admin.notice.form.info")})}),e.jsx(A,{children:e.jsxs("form",{onSubmit:C,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"title",children:t("admin.notice.form.title")}),e.jsx(T,{id:"title",value:i.title,onChange:n=>d({...i,title:n.target.value}),placeholder:t("admin.notice.form.titlePlaceholder"),required:!0,disabled:a})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"category",children:t("admin.notice.form.category")}),e.jsxs(D,{value:i.category,onValueChange:n=>d({...i,category:n}),disabled:a,children:[e.jsx(V,{children:e.jsx(z,{})}),e.jsxs(B,{children:[e.jsx(f,{value:"general",children:t("admin.notice.list.filter.general")}),e.jsx(f,{value:"공지",children:t("admin.notice.list.filter.notice")}),e.jsx(f,{value:"이벤트",children:t("admin.notice.list.filter.event")}),e.jsx(f,{value:"업데이트",children:t("admin.notice.list.filter.update")})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"content",children:t("admin.notice.form.content")}),e.jsx(q,{id:"content",value:i.content,onChange:n=>d({...i,content:n.target.value}),placeholder:t("admin.notice.form.contentPlaceholder"),rows:12,required:!0,disabled:a,className:"font-mono text-sm"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("admin.notice.form.contentNote")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{id:"is_pinned",checked:i.is_pinned,onCheckedChange:n=>d({...i,is_pinned:n===!0}),disabled:a}),e.jsx(h,{htmlFor:"is_pinned",className:"cursor-pointer",children:t("admin.notice.form.pin")})]}),e.jsxs("div",{className:"flex gap-4 pt-4 border-t",children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>s("/admin/notices"),disabled:a,children:t("admin.notice.form.cancel")}),e.jsx(u,{type:"submit",disabled:a,children:a?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"mr-2 h-4 w-4 animate-spin"}),t("admin.notice.form.updateSaving")]}):t("admin.notice.form.updateSave")})]})]})})]})]})}):e.jsx(j,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:t("admin.notice.sessionExpired.title")}),e.jsx("p",{className:"text-muted-foreground",children:t("admin.notice.sessionExpired.body")}),e.jsx(u,{onClick:()=>s("/admin/login"),children:t("admin.notice.sessionExpired.cta")})]})})}export{Z as default};
