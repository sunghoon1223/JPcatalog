import{j as s}from"./ui-vendor-BS5GZUyc.js";import{r as k,u as oe,f as _e}from"./react-vendor-DBrcAiLk.js";import{c as ue,B as L,S as G,a0 as R,au as ke,av as Oe,f as v,aw as Se,ax as F,ay as ee,ak as De,J as me,K as Te,O as Me,Q as Pe,R as Ye,ar as Ee,T as V,a5 as Ce,as as T,t as O,h as Z,p as he,C as $,a as A,_ as fe,W as xe,d as te,am as J,ag as We,D as qe,at as He}from"./index-Bh55jjaf.js";import{E as Le,A as Ie}from"./AdminControls-Dj_Pos4b.js";import{g as X,t as Y,c as q,a as ae,d as Be,f as ge,e as Fe,T as Ge,k as we}from"./ko-CR-NgmWZ.js";import{H as se}from"./heart-EQtgfMWf.js";import{S as $e}from"./square-pen-BSEvBYrd.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=ue("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=ue("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]);function I(e,t){var u,d,h,f;const a=X(),r=(t==null?void 0:t.weekStartsOn)??((d=(u=t==null?void 0:t.locale)==null?void 0:u.options)==null?void 0:d.weekStartsOn)??a.weekStartsOn??((f=(h=a.locale)==null?void 0:h.options)==null?void 0:f.weekStartsOn)??0,n=Y(e),i=n.getDay(),l=(i<r?7:0)+i-r;return n.setDate(n.getDate()-l),n.setHours(0,0,0,0),n}function Q(e){return I(e,{weekStartsOn:1})}function je(e){const t=Y(e),a=t.getFullYear(),r=q(e,0);r.setFullYear(a+1,0,4),r.setHours(0,0,0,0);const n=Q(r),i=q(e,0);i.setFullYear(a,0,4),i.setHours(0,0,0,0);const l=Q(i);return t.getTime()>=n.getTime()?a+1:t.getTime()>=l.getTime()?a:a-1}function re(e){const t=Y(e);return t.setHours(0,0,0,0),t}function Ae(e,t){const a=re(e),r=re(t),n=+a-ae(a),i=+r-ae(r);return Math.round((n-i)/Be)}function Qe(e){const t=je(e),a=q(e,0);return a.setFullYear(t,0,4),a.setHours(0,0,0,0),Q(a)}function Re(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function Xe(e){if(!Re(e)&&typeof e!="number")return!1;const t=Y(e);return!isNaN(Number(t))}function ze(e){const t=Y(e),a=q(e,0);return a.setFullYear(t.getFullYear(),0,1),a.setHours(0,0,0,0),a}function Ve(e){const t=Y(e);return Ae(t,ze(t))+1}function Ze(e){const t=Y(e),a=+Q(t)-+Qe(t);return Math.round(a/ge)+1}function pe(e,t){var f,p,x,w;const a=Y(e),r=a.getFullYear(),n=X(),i=(t==null?void 0:t.firstWeekContainsDate)??((p=(f=t==null?void 0:t.locale)==null?void 0:f.options)==null?void 0:p.firstWeekContainsDate)??n.firstWeekContainsDate??((w=(x=n.locale)==null?void 0:x.options)==null?void 0:w.firstWeekContainsDate)??1,l=q(e,0);l.setFullYear(r+1,0,i),l.setHours(0,0,0,0);const u=I(l,t),d=q(e,0);d.setFullYear(r,0,i),d.setHours(0,0,0,0);const h=I(d,t);return a.getTime()>=u.getTime()?r+1:a.getTime()>=h.getTime()?r:r-1}function Je(e,t){var u,d,h,f;const a=X(),r=(t==null?void 0:t.firstWeekContainsDate)??((d=(u=t==null?void 0:t.locale)==null?void 0:u.options)==null?void 0:d.firstWeekContainsDate)??a.firstWeekContainsDate??((f=(h=a.locale)==null?void 0:h.options)==null?void 0:f.firstWeekContainsDate)??1,n=pe(e,t),i=q(e,0);return i.setFullYear(n,0,r),i.setHours(0,0,0,0),I(i,t)}function Ke(e,t){const a=Y(e),r=+I(a,t)-+Je(a,t);return Math.round(r/ge)+1}function m(e,t){const a=e<0?"-":"",r=Math.abs(e).toString().padStart(t,"0");return a+r}const C={y(e,t){const a=e.getFullYear(),r=a>0?a:1-a;return m(t==="yy"?r%100:r,t.length)},M(e,t){const a=e.getMonth();return t==="M"?String(a+1):m(a+1,2)},d(e,t){return m(e.getDate(),t.length)},a(e,t){const a=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return a.toUpperCase();case"aaa":return a;case"aaaaa":return a[0];case"aaaa":default:return a==="am"?"a.m.":"p.m."}},h(e,t){return m(e.getHours()%12||12,t.length)},H(e,t){return m(e.getHours(),t.length)},m(e,t){return m(e.getMinutes(),t.length)},s(e,t){return m(e.getSeconds(),t.length)},S(e,t){const a=t.length,r=e.getMilliseconds(),n=Math.trunc(r*Math.pow(10,a-3));return m(n,t.length)}},H={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},ne={G:function(e,t,a){const r=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return a.era(r,{width:"abbreviated"});case"GGGGG":return a.era(r,{width:"narrow"});case"GGGG":default:return a.era(r,{width:"wide"})}},y:function(e,t,a){if(t==="yo"){const r=e.getFullYear(),n=r>0?r:1-r;return a.ordinalNumber(n,{unit:"year"})}return C.y(e,t)},Y:function(e,t,a,r){const n=pe(e,r),i=n>0?n:1-n;if(t==="YY"){const l=i%100;return m(l,2)}return t==="Yo"?a.ordinalNumber(i,{unit:"year"}):m(i,t.length)},R:function(e,t){const a=je(e);return m(a,t.length)},u:function(e,t){const a=e.getFullYear();return m(a,t.length)},Q:function(e,t,a){const r=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(r);case"QQ":return m(r,2);case"Qo":return a.ordinalNumber(r,{unit:"quarter"});case"QQQ":return a.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return a.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return a.quarter(r,{width:"wide",context:"formatting"})}},q:function(e,t,a){const r=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(r);case"qq":return m(r,2);case"qo":return a.ordinalNumber(r,{unit:"quarter"});case"qqq":return a.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return a.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return a.quarter(r,{width:"wide",context:"standalone"})}},M:function(e,t,a){const r=e.getMonth();switch(t){case"M":case"MM":return C.M(e,t);case"Mo":return a.ordinalNumber(r+1,{unit:"month"});case"MMM":return a.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return a.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return a.month(r,{width:"wide",context:"formatting"})}},L:function(e,t,a){const r=e.getMonth();switch(t){case"L":return String(r+1);case"LL":return m(r+1,2);case"Lo":return a.ordinalNumber(r+1,{unit:"month"});case"LLL":return a.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return a.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return a.month(r,{width:"wide",context:"standalone"})}},w:function(e,t,a,r){const n=Ke(e,r);return t==="wo"?a.ordinalNumber(n,{unit:"week"}):m(n,t.length)},I:function(e,t,a){const r=Ze(e);return t==="Io"?a.ordinalNumber(r,{unit:"week"}):m(r,t.length)},d:function(e,t,a){return t==="do"?a.ordinalNumber(e.getDate(),{unit:"date"}):C.d(e,t)},D:function(e,t,a){const r=Ve(e);return t==="Do"?a.ordinalNumber(r,{unit:"dayOfYear"}):m(r,t.length)},E:function(e,t,a){const r=e.getDay();switch(t){case"E":case"EE":case"EEE":return a.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return a.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return a.day(r,{width:"short",context:"formatting"});case"EEEE":default:return a.day(r,{width:"wide",context:"formatting"})}},e:function(e,t,a,r){const n=e.getDay(),i=(n-r.weekStartsOn+8)%7||7;switch(t){case"e":return String(i);case"ee":return m(i,2);case"eo":return a.ordinalNumber(i,{unit:"day"});case"eee":return a.day(n,{width:"abbreviated",context:"formatting"});case"eeeee":return a.day(n,{width:"narrow",context:"formatting"});case"eeeeee":return a.day(n,{width:"short",context:"formatting"});case"eeee":default:return a.day(n,{width:"wide",context:"formatting"})}},c:function(e,t,a,r){const n=e.getDay(),i=(n-r.weekStartsOn+8)%7||7;switch(t){case"c":return String(i);case"cc":return m(i,t.length);case"co":return a.ordinalNumber(i,{unit:"day"});case"ccc":return a.day(n,{width:"abbreviated",context:"standalone"});case"ccccc":return a.day(n,{width:"narrow",context:"standalone"});case"cccccc":return a.day(n,{width:"short",context:"standalone"});case"cccc":default:return a.day(n,{width:"wide",context:"standalone"})}},i:function(e,t,a){const r=e.getDay(),n=r===0?7:r;switch(t){case"i":return String(n);case"ii":return m(n,t.length);case"io":return a.ordinalNumber(n,{unit:"day"});case"iii":return a.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return a.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return a.day(r,{width:"short",context:"formatting"});case"iiii":default:return a.day(r,{width:"wide",context:"formatting"})}},a:function(e,t,a){const n=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return a.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"aaa":return a.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return a.dayPeriod(n,{width:"narrow",context:"formatting"});case"aaaa":default:return a.dayPeriod(n,{width:"wide",context:"formatting"})}},b:function(e,t,a){const r=e.getHours();let n;switch(r===12?n=H.noon:r===0?n=H.midnight:n=r/12>=1?"pm":"am",t){case"b":case"bb":return a.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"bbb":return a.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return a.dayPeriod(n,{width:"narrow",context:"formatting"});case"bbbb":default:return a.dayPeriod(n,{width:"wide",context:"formatting"})}},B:function(e,t,a){const r=e.getHours();let n;switch(r>=17?n=H.evening:r>=12?n=H.afternoon:r>=4?n=H.morning:n=H.night,t){case"B":case"BB":case"BBB":return a.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"BBBBB":return a.dayPeriod(n,{width:"narrow",context:"formatting"});case"BBBB":default:return a.dayPeriod(n,{width:"wide",context:"formatting"})}},h:function(e,t,a){if(t==="ho"){let r=e.getHours()%12;return r===0&&(r=12),a.ordinalNumber(r,{unit:"hour"})}return C.h(e,t)},H:function(e,t,a){return t==="Ho"?a.ordinalNumber(e.getHours(),{unit:"hour"}):C.H(e,t)},K:function(e,t,a){const r=e.getHours()%12;return t==="Ko"?a.ordinalNumber(r,{unit:"hour"}):m(r,t.length)},k:function(e,t,a){let r=e.getHours();return r===0&&(r=24),t==="ko"?a.ordinalNumber(r,{unit:"hour"}):m(r,t.length)},m:function(e,t,a){return t==="mo"?a.ordinalNumber(e.getMinutes(),{unit:"minute"}):C.m(e,t)},s:function(e,t,a){return t==="so"?a.ordinalNumber(e.getSeconds(),{unit:"second"}):C.s(e,t)},S:function(e,t){return C.S(e,t)},X:function(e,t,a){const r=e.getTimezoneOffset();if(r===0)return"Z";switch(t){case"X":return ce(r);case"XXXX":case"XX":return W(r);case"XXXXX":case"XXX":default:return W(r,":")}},x:function(e,t,a){const r=e.getTimezoneOffset();switch(t){case"x":return ce(r);case"xxxx":case"xx":return W(r);case"xxxxx":case"xxx":default:return W(r,":")}},O:function(e,t,a){const r=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+ie(r,":");case"OOOO":default:return"GMT"+W(r,":")}},z:function(e,t,a){const r=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+ie(r,":");case"zzzz":default:return"GMT"+W(r,":")}},t:function(e,t,a){const r=Math.trunc(e.getTime()/1e3);return m(r,t.length)},T:function(e,t,a){const r=e.getTime();return m(r,t.length)}};function ie(e,t=""){const a=e>0?"-":"+",r=Math.abs(e),n=Math.trunc(r/60),i=r%60;return i===0?a+String(n):a+String(n)+t+m(i,2)}function ce(e,t){return e%60===0?(e>0?"-":"+")+m(Math.abs(e)/60,2):W(e,t)}function W(e,t=""){const a=e>0?"-":"+",r=Math.abs(e),n=m(Math.trunc(r/60),2),i=m(r%60,2);return a+n+t+i}const le=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},be=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},Ue=(e,t)=>{const a=e.match(/(P+)(p+)?/)||[],r=a[1],n=a[2];if(!n)return le(e,t);let i;switch(r){case"P":i=t.dateTime({width:"short"});break;case"PP":i=t.dateTime({width:"medium"});break;case"PPP":i=t.dateTime({width:"long"});break;case"PPPP":default:i=t.dateTime({width:"full"});break}return i.replace("{{date}}",le(r,t)).replace("{{time}}",be(n,t))},et={p:be,P:Ue},tt=/^D+$/,at=/^Y+$/,st=["D","DD","YY","YYYY"];function rt(e){return tt.test(e)}function nt(e){return at.test(e)}function it(e,t,a){const r=ct(e,t,a);if(console.warn(r),st.includes(e))throw new RangeError(r)}function ct(e,t,a){const r=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${r} to the input \`${a}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const lt=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,dt=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,ot=/^'([^]*?)'?$/,ut=/''/g,mt=/[a-zA-Z]/;function Ne(e,t,a){var f,p,x,w,N,S,_,M;const r=X(),n=(a==null?void 0:a.locale)??r.locale??Fe,i=(a==null?void 0:a.firstWeekContainsDate)??((p=(f=a==null?void 0:a.locale)==null?void 0:f.options)==null?void 0:p.firstWeekContainsDate)??r.firstWeekContainsDate??((w=(x=r.locale)==null?void 0:x.options)==null?void 0:w.firstWeekContainsDate)??1,l=(a==null?void 0:a.weekStartsOn)??((S=(N=a==null?void 0:a.locale)==null?void 0:N.options)==null?void 0:S.weekStartsOn)??r.weekStartsOn??((M=(_=r.locale)==null?void 0:_.options)==null?void 0:M.weekStartsOn)??0,u=Y(e);if(!Xe(u))throw new RangeError("Invalid time value");let d=t.match(dt).map(j=>{const y=j[0];if(y==="p"||y==="P"){const P=et[y];return P(j,n.formatLong)}return j}).join("").match(lt).map(j=>{if(j==="''")return{isToken:!1,value:"'"};const y=j[0];if(y==="'")return{isToken:!1,value:ht(j)};if(ne[y])return{isToken:!0,value:j};if(y.match(mt))throw new RangeError("Format string contains an unescaped latin alphabet character `"+y+"`");return{isToken:!1,value:j}});n.localize.preprocessor&&(d=n.localize.preprocessor(u,d));const h={firstWeekContainsDate:i,weekStartsOn:l,locale:n};return d.map(j=>{if(!j.isToken)return j.value;const y=j.value;(!(a!=null&&a.useAdditionalWeekYearTokens)&&nt(y)||!(a!=null&&a.useAdditionalDayOfYearTokens)&&rt(y))&&it(y,t,String(e));const P=ne[y[0]];return P(u,y,n.localize,h)}).join("")}function ht(e){const t=e.match(ot);return t?t[1].replace(ut,"'"):e}function ft({comment:e,postId:t,onCommentUpdate:a,onAdminReply:r}){var S;const{user:n}=R(),[i,l]=k.useState(!1),[u,d]=k.useState(""),[h,f]=k.useState(!1);if(!(((S=n==null?void 0:n.user_metadata)==null?void 0:S.role)==="admin"))return null;const x=async _=>{try{f(!0),await T.updateCommentStatus(e.id,_),a==null||a()}catch(M){console.error("Comment status change error:",M)}finally{f(!1)}},w=async()=>{if(!u.trim()){O({title:"내용을 입력해주세요",description:"댓글 내용을 입력한 후 작성해주세요.",variant:"destructive"});return}try{f(!0),await T.createAdminComment({post_id:t,parent_id:e.id,content:u.trim()}),d(""),l(!1),r==null||r(u.trim(),e.id),a==null||a(),O({title:"관리자 답변 완료",description:"관리자 답변이 성공적으로 작성되었습니다."})}catch(_){console.error("Admin reply error:",_),O({title:"답변 작성 실패",description:_.message||"답변 작성에 실패했습니다.",variant:"destructive"})}finally{f(!1)}},N=()=>{switch(e.status){case"published":return s.jsx(L,{variant:"outline",className:"text-green-600 border-green-600",children:"게시중"});case"hidden":return s.jsx(L,{variant:"outline",className:"text-yellow-600 border-yellow-600",children:"숨김"});case"deleted":return s.jsx(L,{variant:"outline",className:"text-red-600 border-red-600",children:"삭제"});default:return null}};return s.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[s.jsxs(L,{variant:"outline",className:"text-red-600 border-red-600 text-xs",children:[s.jsx(G,{className:"h-3 w-3 mr-1"}),"관리자"]}),N(),s.jsxs(ke,{children:[s.jsx(Oe,{asChild:!0,children:s.jsx(v,{variant:"ghost",size:"sm",disabled:h,children:s.jsx(Le,{className:"h-3 w-3"})})}),s.jsxs(Se,{align:"end",children:[s.jsxs(F,{onClick:()=>l(!0),children:[s.jsx(K,{className:"h-4 w-4 mr-2"}),"관리자 답변"]}),s.jsx(ee,{}),e.status==="published"&&s.jsxs(F,{onClick:()=>x("hidden"),children:[s.jsx(De,{className:"h-4 w-4 mr-2"}),"댓글 숨김"]}),e.status==="hidden"&&s.jsxs(F,{onClick:()=>x("published"),children:[s.jsx(me,{className:"h-4 w-4 mr-2"}),"댓글 표시"]}),s.jsx(ee,{}),s.jsxs(F,{onClick:()=>x("deleted"),className:"text-red-600",children:[s.jsx(Ge,{className:"h-4 w-4 mr-2"}),"댓글 삭제"]})]})]}),s.jsx(Te,{open:i,onOpenChange:l,children:s.jsxs(Me,{className:"sm:max-w-[500px]",children:[s.jsxs(Pe,{children:[s.jsxs(Ye,{className:"flex items-center gap-2",children:[s.jsx(G,{className:"h-5 w-5 text-red-600"}),"관리자 답변 작성"]}),s.jsx(Ee,{children:"이 댓글에 관리자 답변을 작성합니다."})]}),s.jsxs("div",{className:"space-y-4 py-4",children:[s.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[s.jsx("div",{className:"text-sm text-gray-600 font-medium mb-1",children:"원본 댓글:"}),s.jsx("div",{className:"text-sm",children:e.content})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium",children:"관리자 답변"}),s.jsx(V,{placeholder:"관리자 답변을 입력해주세요...",value:u,onChange:_=>d(_.target.value),rows:4,className:"resize-none"})]})]}),s.jsxs(Ce,{children:[s.jsx(v,{variant:"outline",onClick:()=>l(!1),disabled:h,children:"취소"}),s.jsxs(v,{onClick:w,disabled:h||!u.trim(),children:[s.jsx(K,{className:"h-4 w-4 mr-1"}),h?"작성 중...":"답변 작성"]})]})]})})]})}function xt({isAdminReply:e}){return e?s.jsxs(L,{variant:"outline",className:"text-blue-600 border-blue-600 text-xs ml-2",children:[s.jsx(G,{className:"h-3 w-3 mr-1"}),"관리자 답변"]}):null}function gt({comments:e,postId:t,onCommentCreate:a,onCommentDelete:r,onCommentsUpdate:n}){var o;const{user:i}=R(),[l,u]=k.useState(""),[d,h]=k.useState(null),[f,p]=k.useState(""),[x,w]=k.useState(!1),N=((o=i==null?void 0:i.user_metadata)==null?void 0:o.role)==="admin",S=c=>Ne(new Date(c),"yyyy년 MM월 dd일 HH:mm",{locale:we}),_=async c=>{if(c.preventDefault(),!(!l.trim()||x)){w(!0);try{await(a==null?void 0:a(l)),u("")}finally{w(!1)}}},M=async(c,b)=>{if(c.preventDefault(),!(!f.trim()||x)){w(!0);try{await(a==null?void 0:a(f,b)),p(""),h(null)}finally{w(!1)}}},j=c=>{window.confirm("정말로 이 댓글을 삭제하시겠습니까?")&&(r==null||r(c))},y=c=>{var b;return c.user_id===(i==null?void 0:i.id)||((b=i==null?void 0:i.user_metadata)==null?void 0:b.role)==="admin"},P=(c,b=!1)=>c.status==="deleted"?s.jsx("div",{className:`${b?"ml-8":""} py-4`,children:s.jsx("div",{className:"text-gray-500 italic",children:"삭제된 댓글입니다."})},c.id):c.status==="hidden"&&!N?null:s.jsxs("div",{className:`${b?"ml-8":""}`,children:[s.jsx($,{className:`mb-4 ${c.status==="hidden"?"opacity-50 border-yellow-300":""}`,children:s.jsxs(A,{className:"pt-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600 flex-wrap",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[c.is_admin_reply?s.jsx(G,{className:"h-4 w-4 text-red-500"}):s.jsx(fe,{className:"h-4 w-4"}),s.jsx("span",{className:c.is_admin_reply?"text-red-600 font-medium":"",children:c.user_id?c.is_admin_reply?"관리자":"작성자":c.author_name||"익명"})]}),s.jsx(xt,{isAdminReply:c.is_admin_reply}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(xe,{className:"h-4 w-4"}),s.jsx("span",{children:S(c.created_at)})]}),c.status==="hidden"&&N&&s.jsx("span",{className:"text-yellow-600 text-xs font-medium",children:"(숨김)"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[!b&&s.jsxs(v,{variant:"ghost",size:"sm",onClick:()=>h(d===c.id?null:c.id),children:[s.jsx(K,{className:"h-4 w-4 mr-1"}),"답글"]}),y(c)&&s.jsx(v,{variant:"ghost",size:"sm",onClick:()=>j(c.id),className:"text-red-600 hover:text-red-700",children:s.jsx(ye,{className:"h-4 w-4"})})]})]}),s.jsx("div",{className:"text-gray-900 whitespace-pre-wrap mb-3",children:c.content}),N&&s.jsx(ft,{comment:c,postId:t,onCommentUpdate:n,onAdminReply:(D,B)=>{a==null||a(D,B)}}),d===c.id&&s.jsx("div",{className:"mt-4 pt-4 border-t",children:s.jsxs("form",{onSubmit:D=>M(D,c.id),children:[s.jsx(V,{placeholder:"답글을 작성하세요...",value:f,onChange:D=>p(D.target.value),className:"mb-3",rows:3}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(v,{type:"submit",size:"sm",disabled:!f.trim()||x,children:x?"작성 중...":"답글 작성"}),s.jsx(v,{type:"button",variant:"outline",size:"sm",onClick:()=>{h(null),p("")},children:"취소"})]})]})})]})}),c.replies&&c.replies.length>0&&s.jsx("div",{className:"ml-8 space-y-2",children:c.replies.map(D=>P(D,!0))})]},c.id),E=e.filter(c=>!c.parent_id);return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Z,{className:"h-5 w-5 text-gray-600"}),s.jsxs("h3",{className:"text-lg font-semibold",children:["댓글 (",e.length,")"]})]}),s.jsx(he,{}),s.jsx($,{children:s.jsx(A,{className:"pt-6",children:s.jsxs("form",{onSubmit:_,children:[s.jsx(V,{placeholder:"댓글을 작성하세요...",value:l,onChange:c=>u(c.target.value),className:"mb-4",rows:4}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-gray-500",children:i?"회원으로 댓글을 작성합니다.":"로그인 후 댓글을 작성할 수 있습니다."}),s.jsx(v,{type:"submit",disabled:!l.trim()||x||!i,children:x?"작성 중...":"댓글 작성"})]})]})})}),s.jsx("div",{className:"space-y-4",children:E.length===0?s.jsxs("div",{className:"text-center py-8",children:[s.jsx(Z,{className:"mx-auto h-12 w-12 text-gray-400"}),s.jsx("h4",{className:"mt-4 text-lg font-medium text-gray-900",children:"댓글이 없습니다"}),s.jsx("p",{className:"mt-2 text-gray-600",children:"첫 번째 댓글을 작성해보세요."})]}):E.map(c=>P(c))})]})}function wt({post:e,loading:t,onLike:a,onDelete:r,onCommentCreate:n,onCommentDelete:i,onPostUpdate:l}){var b,D,B,U;const u=oe(),{user:d}=R(),[h,f]=k.useState(!1),p=e.user_id===(d==null?void 0:d.id)||((b=d==null?void 0:d.user_metadata)==null?void 0:b.role)==="admin",x=p,w=((D=d==null?void 0:d.user_metadata)==null?void 0:D.role)==="admin",N=()=>{var g;u(`/board/${(g=e.board)==null?void 0:g.slug}`)},S=()=>{var g;u(`/board/${(g=e.board)==null?void 0:g.slug}/${e.id}/edit`)},_=async()=>{a&&(await a(),f(!h))},M=()=>{window.confirm("정말로 이 게시글을 삭제하시겠습니까?")&&(r==null||r())},j=async()=>{try{await T.togglePostPin(e.id),l==null||l(),O({title:e.is_pinned?"게시글 고정 해제 완료":"게시글 고정 완료",description:e.is_pinned?"게시글 고정이 해제되었습니다.":"게시글이 상단에 고정되었습니다."})}catch(g){console.error("Toggle pin error:",g)}},y=async()=>{try{await T.togglePostPin(e.id),l==null||l(),O({title:"게시글 고정 해제 완료",description:"게시글 고정이 해제되었습니다."})}catch(g){console.error("Unpin post error:",g)}},P=async()=>{var g;if(window.confirm("정말로 이 게시글을 삭제하시겠습니까?"))try{await T.deletePost(e.id),u(`/board/${(g=e.board)==null?void 0:g.slug}`),O({title:"게시글 삭제 완료",description:"게시글이 성공적으로 삭제되었습니다."})}catch(ve){console.error("Delete post error:",ve)}},E=g=>{switch(g){case"notice":return"공지";case"pinned":return"고정";default:return null}},o=g=>{switch(g){case"notice":return"destructive";case"pinned":return"secondary";default:return"outline"}},c=g=>Ne(new Date(g),"yyyy년 MM월 dd일 HH:mm",{locale:we});return t?s.jsxs("div",{className:"space-y-6",children:[s.jsxs(v,{variant:"ghost",size:"sm",className:"animate-pulse",children:[s.jsx("div",{className:"h-4 w-4 bg-gray-200 rounded mr-2"}),s.jsx("div",{className:"h-4 w-16 bg-gray-200 rounded"})]}),s.jsxs($,{className:"animate-pulse",children:[s.jsx(te,{children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"h-5 w-12 bg-gray-200 rounded"}),s.jsx("div",{className:"h-6 w-64 bg-gray-200 rounded"})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"h-4 w-16 bg-gray-200 rounded"}),s.jsx("div",{className:"h-4 w-32 bg-gray-200 rounded"})]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"h-4 w-12 bg-gray-200 rounded"}),s.jsx("div",{className:"h-4 w-12 bg-gray-200 rounded"}),s.jsx("div",{className:"h-4 w-12 bg-gray-200 rounded"})]})]})]})}),s.jsx(A,{children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"h-4 w-full bg-gray-200 rounded"}),s.jsx("div",{className:"h-4 w-3/4 bg-gray-200 rounded"}),s.jsx("div",{className:"h-4 w-1/2 bg-gray-200 rounded"})]})})]})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs(v,{variant:"ghost",size:"sm",onClick:N,children:[s.jsx(J,{className:"h-4 w-4 mr-2"}),"목록으로"]}),s.jsxs($,{children:[s.jsx(te,{children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-start justify-between gap-3",children:[s.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.is_pinned&&s.jsx(We,{className:"h-4 w-4 text-red-500"}),E(e.post_type)&&s.jsx(L,{variant:o(e.post_type),children:E(e.post_type)})]}),s.jsx("h1",{className:"text-2xl font-bold text-gray-900 flex-1",children:e.title})]}),w&&s.jsx(Ie,{type:"post",post:e,onPin:j,onUnpin:y,onDelete:P})]}),s.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(fe,{className:"h-4 w-4"}),s.jsx("span",{children:e.user_id?"회원":e.author_name||"익명"})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(xe,{className:"h-4 w-4"}),s.jsx("span",{children:c(e.created_at)})]})]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(me,{className:"h-4 w-4"}),s.jsx("span",{children:e.views})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(Z,{className:"h-4 w-4"}),s.jsx("span",{children:((B=e.comments)==null?void 0:B.length)||0})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(se,{className:`h-4 w-4 ${h?"text-red-500 fill-current":""}`}),s.jsx("span",{children:e.likes})]})]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs(v,{variant:"outline",size:"sm",onClick:_,className:`flex items-center gap-1 ${h?"text-red-500":""}`,children:[s.jsx(se,{className:`h-4 w-4 ${h?"fill-current":""}`}),"좋아요 ",e.likes]})}),(p||x)&&s.jsxs("div",{className:"flex items-center gap-2",children:[p&&s.jsxs(v,{variant:"outline",size:"sm",onClick:S,children:[s.jsx($e,{className:"h-4 w-4 mr-1"}),"수정"]}),x&&s.jsxs(v,{variant:"outline",size:"sm",onClick:M,children:[s.jsx(ye,{className:"h-4 w-4 mr-1"}),"삭제"]})]})]})]})}),s.jsx(he,{}),s.jsxs(A,{className:"pt-6",children:[s.jsx("div",{className:"prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:e.content}}),e.attachments&&e.attachments.length>0&&s.jsxs("div",{className:"mt-8 pt-6 border-t",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"첨부파일"}),s.jsx("div",{className:"space-y-2",children:e.attachments.map(g=>s.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[s.jsx(qe,{className:"h-4 w-4 text-gray-500"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium",children:g.original_filename}),s.jsxs("div",{className:"text-sm text-gray-500",children:[Math.round(g.file_size/1024),"KB"]})]}),s.jsx(v,{size:"sm",variant:"outline",children:"다운로드"})]},g.id))})]})]})]}),((U=e.board)==null?void 0:U.settings.allow_comments)&&s.jsx(gt,{comments:e.comments||[],postId:e.id,onCommentCreate:n,onCommentDelete:i,onCommentsUpdate:l})]})}const z={notice:{id:"1",name:"공지사항",slug:"notice",type:"notice",description:"중요한 공지사항을 확인하세요",settings:{allow_anonymous:!1,require_approval:!1,allow_comments:!0,allow_attachments:!0,max_attachment_size:10485760},sort_order:1,is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},qna:{id:"2",name:"Q&A",slug:"qna",type:"qna",description:"궁금한 점을 문의하세요",settings:{allow_anonymous:!0,require_approval:!1,allow_comments:!0,allow_attachments:!0,max_attachment_size:10485760},sort_order:2,is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},review:{id:"3",name:"제품 리뷰",slug:"review",type:"review",description:"제품 사용 후기를 공유하세요",settings:{allow_anonymous:!1,require_approval:!0,allow_comments:!0,allow_attachments:!0,max_attachment_size:10485760},sort_order:3,is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},general:{id:"4",name:"자유게시판",slug:"general",type:"general",description:"자유롭게 소통하는 공간",settings:{allow_anonymous:!0,require_approval:!1,allow_comments:!0,allow_attachments:!0,max_attachment_size:10485760},sort_order:4,is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}},de={1:{id:"1",board_id:"1",title:"JP Caster 신제품 출시 안내",content:"안녕하세요. JP Caster입니다.\\n\\n2025년 신제품 라인업을 소개합니다.\\n\\n- AGV 캐스터 신모델\\n- 고하중 산업용 캐스터\\n- 저소음 폴리우레탄 휠\\n\\n자세한 내용은 제품 페이지를 참고해주세요.",excerpt:"2025년 신제품 라인업을 소개합니다.",status:"published",post_type:"pinned",is_pinned:!0,views:156,likes:23,author_name:"JP Caster 관리자",is_answered:!1,created_at:"2025-01-15T10:00:00Z",updated_at:"2025-01-15T10:00:00Z"},2:{id:"2",board_id:"2",title:"AGV 캐스터 하중 문의",content:"AGV 캐스터 중에서 500kg 이상 하중을 견딜 수 있는 제품이 있나요?\\n\\n현재 물류창고에서 사용할 예정입니다.",excerpt:"고하중 AGV 캐스터 문의",status:"published",post_type:"normal",is_pinned:!1,views:34,likes:2,author_name:"김철수",is_answered:!0,created_at:"2025-01-14T15:30:00Z",updated_at:"2025-01-14T15:30:00Z"}},yt={2:[{id:"1",post_id:"2",user_id:null,content:"네, 저희 헤비듀티 시리즈에서 최대 1톤까지 지원하는 제품이 있습니다. 제품 페이지에서 확인해주세요.",author_name:"JP Caster 지원팀",author_email:"support@jpcaster.com",is_admin_reply:!0,created_at:"2025-01-14T16:00:00Z",updated_at:"2025-01-14T16:00:00Z"}]};function Ot(){const{boardSlug:e,postId:t}=_e(),a=oe(),{user:r}=R(),[n,i]=k.useState(null),[l,u]=k.useState(null),[d,h]=k.useState([]),[f,p]=k.useState(!0),[x,w]=k.useState(null),[N,S]=k.useState(!1);k.useEffect(()=>{_()},[e,t]);const _=async()=>{if(!e||!t){w("게시글을 찾을 수 없습니다."),p(!1);return}try{p(!0),w(null),S(!1);const o=await T.getBoard(e);if(!o)throw new Error("게시판을 찾을 수 없습니다.");i(o);const c=await T.getPost(t);if(!c)throw new Error("게시글을 찾을 수 없습니다.");u(c),await T.updatePostViews(t);const b=await T.getComments(t);h(b)}catch(o){console.error("Post data loading error:",o),e&&z[e]?(i(z[e]),S(!0),t&&de[t]?(u(de[t]),h(yt[t]||[]),w(null)):(u({id:t,board_id:z[e].id,title:"샘플 게시글",content:"이 게시글은 오프라인 모드에서 표시되는 샘플 게시글입니다.\\n\\n실제 데이터베이스에 연결되면 실제 게시글이 표시됩니다.",excerpt:"샘플 게시글입니다.",status:"published",post_type:"normal",is_pinned:!1,views:1,likes:0,author_name:"샘플 작성자",is_answered:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),w(null))):w(o.message||"데이터를 불러오는데 실패했습니다.")}finally{p(!1)}},M=()=>{a(`/board/${e}/post/${t}/edit`)},j=async()=>{if(!(!t||N)&&window.confirm("정말로 이 게시글을 삭제하시겠습니까?"))try{await T.deletePost(t),O({title:"게시글 삭제 완료",description:"게시글이 성공적으로 삭제되었습니다."}),a(`/board/${e}`)}catch(o){O({title:"삭제 실패",description:o.message||"게시글 삭제에 실패했습니다.",variant:"destructive"})}},y=async()=>{if(!(!t||N))try{await T.updatePostLikes(t),u(o=>o&&{...o,likes:o.likes+1}),O({title:"좋아요!",description:"이 게시글을 추천했습니다."})}catch{O({title:"오류",description:"추천에 실패했습니다.",variant:"destructive"})}},P=async(o,c)=>{if(!t||N){O({title:"오프라인 모드",description:"오프라인 모드에서는 댓글을 작성할 수 없습니다.",variant:"destructive"});return}try{const b=await T.createComment({post_id:t,content:o,parent_id:c});h(D=>[...D,b]),O({title:"댓글 작성 완료",description:"댓글이 성공적으로 작성되었습니다."})}catch(b){O({title:"댓글 작성 실패",description:b.message||"댓글 작성에 실패했습니다.",variant:"destructive"})}},E=()=>{a(`/board/${e}`)};return f?s.jsx("div",{className:"container mx-auto px-4 py-8",children:s.jsx(He,{className:"mx-auto"})}):x||!n||!l?s.jsx("div",{className:"container mx-auto px-4 py-8",children:s.jsxs("div",{className:"text-center",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"오류 발생"}),s.jsx("p",{className:"text-gray-600 mb-6",children:x||"게시글을 찾을 수 없습니다."}),s.jsxs(v,{onClick:E,children:[s.jsx(J,{className:"h-4 w-4 mr-2"}),"게시판으로 돌아가기"]})]})}):s.jsxs("div",{className:"container mx-auto px-4 py-8",children:[s.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[s.jsxs(v,{variant:"ghost",size:"sm",onClick:E,children:[s.jsx(J,{className:"h-4 w-4 mr-2"}),n.name," 게시판"]}),N&&s.jsx("div",{className:"text-sm text-orange-600 bg-orange-50 px-3 py-1 rounded-md",children:"오프라인 모드 - 캐시된 데이터 표시 중"})]}),s.jsx(wt,{post:l,board:n,isAuthor:(r==null?void 0:r.id)===l.user_id,onEdit:M,onDelete:j,onLike:y}),n.settings.allow_comments&&s.jsx("div",{className:"mt-8",children:s.jsxs("div",{className:"border rounded-lg p-4",children:[s.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["댓글 (",d.length,")"]}),d.length>0?s.jsx("div",{className:"space-y-4",children:d.map(o=>s.jsxs("div",{className:"border-b pb-4 last:border-0",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-2",children:[s.jsx("span",{className:"font-medium",children:o.author_name}),s.jsx("span",{children:"•"}),s.jsx("span",{children:new Date(o.created_at).toLocaleDateString()}),o.is_admin_reply&&s.jsx("span",{className:"bg-blue-100 text-blue-700 px-2 py-1 rounded text-xs",children:"관리자"})]}),s.jsx("p",{className:"text-gray-700",children:o.content})]},o.id))}):s.jsx("p",{className:"text-gray-500 text-center py-8",children:"아직 댓글이 없습니다."}),!N&&s.jsxs("div",{className:"mt-4 pt-4 border-t",children:[s.jsx("textarea",{className:"w-full p-3 border rounded-lg resize-none",rows:3,placeholder:"댓글을 입력하세요...",onKeyDown:o=>{if(o.key==="Enter"&&!o.shiftKey){o.preventDefault();const c=o.target;c.value.trim()&&(P(c.value.trim()),c.value="")}}}),s.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Enter로 댓글 작성, Shift+Enter로 줄바꿈"})]})]})})]})}export{Ot as default};
