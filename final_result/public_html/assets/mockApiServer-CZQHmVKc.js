var d=Object.defineProperty;var m=(u,t,e)=>t in u?d(u,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[t]=e;var n=(u,t,e)=>m(u,typeof t!="symbol"?t+"":t,e);class l{constructor(){n(this,"products",[]);n(this,"categories",[]);n(this,"cartItems",new Map);n(this,"users",new Map);n(this,"orders",[]);n(this,"initialized");this.initialized=this.initializeData()}async initializeData(){try{const t=await fetch("/data/products.json");this.products=await t.json();const e=await fetch("/data/categories.json");this.categories=await e.json(),console.log("ðŸ”„ Mock API Server initialized with:",{products:this.products.length,categories:this.categories.length})}catch(t){console.error("âŒ Failed to initialize mock API data:",t),this.products=[],this.categories=[]}}async handleRequest(t,e={}){await this.initialized;const o=e.method||"GET",r=e.body?JSON.parse(e.body):null;console.log(`ðŸ”„ Mock API: ${o} ${t}`,r);try{if(t.startsWith("/products/list.php"))return this.mockResponse(this.getProducts(t));if(t.startsWith("/products/detail.php")){const s=new URL(`http://localhost${t}`).searchParams.get("id");return this.mockResponse(this.getProductById(s))}if(t==="/categories/list.php")return this.mockResponse(this.categories);if(t==="/cart/list.php")return this.mockResponse(Array.from(this.cartItems.values()));if(t==="/cart/add.php"&&o==="POST")return this.mockResponse(this.addToCart(r));if(t==="/cart/update.php"&&o==="POST")return this.mockResponse(this.updateCartItem(r));if(t==="/cart/remove.php"&&o==="POST")return this.mockResponse(this.removeCartItem(r));if(t==="/cart/clear.php"&&o==="POST")return this.cartItems.clear(),this.mockResponse({message:"Cart cleared"});if(t==="/auth/login.php"&&o==="POST")return this.mockResponse(this.login(r));if(t==="/auth/register.php"&&o==="POST")return this.mockResponse(this.register(r));if(t==="/auth/me.php")return this.mockResponse(this.getCurrentUser());if(t==="/orders/create.php"&&o==="POST")return this.mockResponse(this.createOrder(r));if(t==="/orders/list.php")return this.mockResponse(this.orders);throw new Error(`Endpoint not found: ${t}`)}catch(s){return console.error(`âŒ Mock API error for ${t}:`,s),{success:!1,error:s instanceof Error?s.message:"Unknown error"}}}mockResponse(t){return{success:!0,data:t}}getProducts(t){const e=new URL(`http://localhost${t}`),o=e.searchParams.get("category"),r=e.searchParams.get("search");let s=[...this.products];if(o){const a=this.categories.find(c=>c.slug===o);a?s=s.filter(c=>c.category_id===a.id):s=[]}if(r){const a=r.toLowerCase();s=s.filter(c=>{var i;return c.name.toLowerCase().includes(a)||((i=c.description)==null?void 0:i.toLowerCase().includes(a))})}return s}getProductById(t){return this.products.find(e=>e.id===t)||null}addToCart(t){const{product_id:e,quantity:o=1,session_id:r}=t,s=this.getProductById(e);if(!s)throw new Error("Product not found");const a=`${r}_${e}`,c=this.cartItems.get(a),i={id:a,product_id:e,name:s.name,price:s.price,main_image_url:s.main_image_url,slug:s.slug,quantity:c?c.quantity+o:o,session_id:r,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return this.cartItems.set(a,i),i}updateCartItem(t){const{item_id:e,quantity:o}=t,r=this.cartItems.get(e);if(!r)throw new Error("Cart item not found");return r.quantity=o,r.updated_at=new Date().toISOString(),this.cartItems.set(e,r),r}removeCartItem(t){const{item_id:e}=t;if(!this.cartItems.has(e))throw new Error("Cart item not found");return this.cartItems.delete(e),{message:"Item removed from cart"}}login(t){const{email:e,password:o}=t,r={id:"user_123",email:e,full_name:"Test User",role:"customer"},s=`mock_token_${Date.now()}`;return{user:r,token:s}}register(t){const{email:e,password:o,full_name:r,phone:s}=t,a={id:`user_${Date.now()}`,email:e,full_name:r,phone:s,role:"customer"};this.users.set(a.id,a);const c=`mock_token_${Date.now()}`;return{user:a,token:c}}getCurrentUser(){return{id:"user_123",email:"test@example.com",full_name:"Test User",role:"customer"}}createOrder(t){const{email:e,full_name:o,phone:r,address:s}=t,a=Array.from(this.cartItems.values());if(a.length===0)throw new Error("Cart is empty");const c={id:`order_${Date.now()}`,email:e,full_name:o,phone:r,address:s,total_amount:a.reduce((i,h)=>i+h.price*h.quantity,0),status:"pending",items:a.map(i=>({id:`order_item_${Date.now()}_${i.product_id}`,product_id:i.product_id,product_name:i.name,product_price:i.price,quantity:i.quantity,total_price:i.price*i.quantity})),created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return this.orders.push(c),this.cartItems.clear(),c}}const g=new l;export{g as default,g as mockApiServer};
