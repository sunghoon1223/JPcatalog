import{j as e}from"./ui-vendor-hOSTw39_.js";import{r as u,u as Q,L as ee,e as se,f as ae}from"./react-vendor-CE1B3BJh.js";import{u as W,J as te,N as re,O as le,Q as ne,r as ie,aq as ce,L as B,q as M,I as X,a4 as de,f as w,a3 as oe,ar as b,$ as I,C as Z,d as V,a as H,k as me,h as J,af as xe,B as he,F as ue,ag as je,ah as ge,as as fe,al as R}from"./index-hkAsq3LB.js";import{A as $,a as pe}from"./AdminControls-Bn-7P50S.js";import{S as C,f as ve}from"./switch-2XT4Ytnu.js";import{S as Ne}from"./save-CaA5peuN.js";import{S as we}from"./square-pen-mL6BmYXJ.js";import{H as ye}from"./heart-KJFvuJVS.js";import{k as _e}from"./ko-df8sUQv-.js";function be({board:a,open:d,onOpenChange:j,onSettingsUpdate:x}){var p;const{user:y}=W(),[i,g]=u.useState(a.settings),[n,t]=u.useState(!1),S=((p=y==null?void 0:y.user_metadata)==null?void 0:p.role)==="admin";if(u.useEffect(()=>{g(a.settings)},[a.settings,d]),!S)return null;const _=async()=>{try{t(!0),await b.updateBoardSettings(a.id,i),x==null||x(i),j(!1),I({title:"설정 저장 완료",description:"게시판 설정이 성공적으로 업데이트되었습니다."})}catch(r){console.error("Settings update error:",r),I({title:"설정 저장 실패",description:r.message||"설정 저장에 실패했습니다.",variant:"destructive"})}finally{t(!1)}},f=()=>{g(a.settings),j(!1)},o=(r,k)=>{g(h=>({...h,[r]:k}))};return e.jsx(te,{open:d,onOpenChange:j,children:e.jsxs(re,{className:"sm:max-w-[500px]",children:[e.jsxs(le,{children:[e.jsxs(ne,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5"}),"게시판 설정 - ",a.name]}),e.jsx(ce,{children:"게시판의 기본 설정을 변경할 수 있습니다."})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(B,{className:"text-base",children:"익명 글쓰기 허용"}),e.jsx("div",{className:"text-sm text-gray-500",children:"비회원도 게시글을 작성할 수 있습니다."})]}),e.jsx(C,{checked:i.allow_anonymous,onCheckedChange:r=>o("allow_anonymous",r)})]}),e.jsx(M,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(B,{className:"text-base",children:"게시글 승인 필요"}),e.jsx("div",{className:"text-sm text-gray-500",children:"게시글 작성 후 관리자 승인이 필요합니다."})]}),e.jsx(C,{checked:i.require_approval,onCheckedChange:r=>o("require_approval",r)})]}),e.jsx(M,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(B,{className:"text-base",children:"댓글 허용"}),e.jsx("div",{className:"text-sm text-gray-500",children:"게시글에 댓글을 달 수 있습니다."})]}),e.jsx(C,{checked:i.allow_comments,onCheckedChange:r=>o("allow_comments",r)})]}),e.jsx(M,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(B,{className:"text-base",children:"첨부파일 허용"}),e.jsx("div",{className:"text-sm text-gray-500",children:"게시글에 파일을 첨부할 수 있습니다."})]}),e.jsx(C,{checked:i.allow_attachments,onCheckedChange:r=>o("allow_attachments",r)})]}),i.allow_attachments&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{className:"text-base",children:"첨부파일 최대 크기 (MB)"}),e.jsx(X,{type:"number",min:"1",max:"100",value:Math.round(i.max_attachment_size/(1024*1024)),onChange:r=>{const h=(parseInt(r.target.value)||1)*1024*1024;o("max_attachment_size",h)},className:"w-32"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["현재: ",Math.round(i.max_attachment_size/(1024*1024)),"MB"]})]})]}),e.jsxs(de,{children:[e.jsxs(w,{variant:"outline",onClick:f,disabled:n,children:[e.jsx(oe,{className:"h-4 w-4 mr-1"}),"취소"]}),e.jsxs(w,{onClick:_,disabled:n,children:[e.jsx(Ne,{className:"h-4 w-4 mr-1"}),n?"저장 중...":"저장"]})]})]})})}function Se({board:a,posts:d,totalCount:j,currentPage:x,loading:y,searchQuery:i="",onSearch:g,onPageChange:n,onPostsUpdate:t}){var E;const S=Q(),{user:_}=W(),[f,o]=u.useState([]),[p,r]=u.useState(!1),h=Math.ceil(j/20),v=((E=_==null?void 0:_.user_metadata)==null?void 0:E.role)==="admin",A=s=>{s.preventDefault();const m=s.target.querySelector("input");g==null||g(m.value)},z=()=>{S(`/board/${a.slug}/write`)},q=s=>ve(new Date(s),{addSuffix:!0,locale:_e}),D=s=>{switch(s){case"notice":return"공지";case"pinned":return"고정";default:return null}},N=s=>{switch(s){case"notice":return"destructive";case"pinned":return"secondary";default:return"outline"}},c=(s,l)=>{o(m=>l?[...m,s]:m.filter(O=>O!==s))},L=s=>{o(s?d.map(l=>l.id):[])},T=async s=>{try{await b.togglePostPin(s),t==null||t(),I({title:"게시글 고정 완료",description:"게시글이 상단에 고정되었습니다."})}catch(l){console.error("Pin post error:",l)}},K=async s=>{try{await b.togglePostPin(s),t==null||t(),I({title:"게시글 고정 해제 완료",description:"게시글 고정이 해제되었습니다."})}catch(l){console.error("Unpin post error:",l)}},Y=async s=>{try{await b.bulkDeletePosts(s),o([]),t==null||t()}catch(l){console.error("Bulk delete error:",l)}},P=()=>{r(!0)},U=()=>{t==null||t()};return y?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"h-8 w-48 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-10 w-24 bg-gray-200 rounded animate-pulse"})]}),e.jsx("div",{className:"h-10 w-full bg-gray-200 rounded animate-pulse"}),[...Array(10)].map((s,l)=>e.jsxs(Z,{className:"animate-pulse",children:[e.jsxs(V,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-5 w-12 bg-gray-200 rounded"}),e.jsx("div",{className:"h-6 w-64 bg-gray-200 rounded"})]}),e.jsx("div",{className:"h-4 w-full bg-gray-200 rounded"})]}),e.jsx(H,{className:"pt-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"h-4 w-32 bg-gray-200 rounded"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-4 w-12 bg-gray-200 rounded"}),e.jsx("div",{className:"h-4 w-12 bg-gray-200 rounded"}),e.jsx("div",{className:"h-4 w-12 bg-gray-200 rounded"})]})]})})]},l))]}):e.jsxs("div",{className:"space-y-6",children:[v&&e.jsx($,{type:"bulk",selectedItems:f,onBulkDelete:Y,onBoardSettings:P}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:a.name}),e.jsx("p",{className:"text-gray-600 mt-1",children:a.description})]}),e.jsxs(w,{onClick:z,className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4"}),"글쓰기"]})]}),e.jsxs("form",{onSubmit:A,className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(me,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(X,{type:"text",placeholder:"게시글 검색...",defaultValue:i,className:"pl-10"})]}),e.jsx(w,{type:"submit",variant:"outline",children:"검색"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{children:["총 ",j,"개의 게시글"]}),v&&d.length>0&&e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:f.length===d.length&&d.length>0,onChange:s=>L(s.target.checked),className:"rounded"}),e.jsx("span",{className:"text-xs",children:"전체 선택"})]})]}),e.jsxs("span",{children:[x," / ",h," 페이지"]})]}),e.jsx("div",{className:"space-y-2",children:d.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(J,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-4 text-lg font-semibold text-gray-900",children:"게시글이 없습니다"}),e.jsx("p",{className:"mt-2 text-gray-600",children:i?"검색 결과가 없습니다.":"첫 번째 게시글을 작성해보세요."})]}):d.map(s=>{var l;return e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex items-start gap-3",children:[v&&e.jsx("div",{className:"pt-4",children:e.jsx(pe,{id:s.id,checked:f.includes(s.id),onCheckedChange:c})}),e.jsx("div",{className:"flex-1",children:e.jsx(ee,{to:`/board/${a.slug}/post/${s.id}`,children:e.jsxs(Z,{className:"transition-all duration-200 hover:shadow-md hover:bg-gray-50 cursor-pointer",children:[e.jsxs(V,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap flex-1",children:[s.is_pinned&&e.jsx(xe,{className:"h-4 w-4 text-red-500"}),D(s.post_type)&&e.jsx(he,{variant:N(s.post_type),className:"text-xs",children:D(s.post_type)}),e.jsx("h3",{className:"font-semibold text-gray-900 hover:text-blue-600 transition-colors flex-1",children:s.title})]}),v&&e.jsx("div",{onClick:m=>m.preventDefault(),children:e.jsx($,{type:"post",post:s,onPin:T,onUnpin:K,onDelete:async m=>{await b.deletePost(m),t==null||t()}})})]}),s.excerpt&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:s.excerpt})]}),e.jsx(H,{className:"pt-0",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{children:s.user_id?"회원":s.author_name||"익명"}),e.jsx("span",{children:q(s.created_at)})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:"h-3 w-3"}),e.jsx("span",{children:s.views})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"h-3 w-3"}),e.jsx("span",{children:((l=s.comments)==null?void 0:l.length)||0})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ye,{className:"h-3 w-3"}),e.jsx("span",{children:s.likes})]})]})]})})]})})})]})},s.id)})}),h>1&&e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>n==null?void 0:n(x-1),disabled:x<=1,children:[e.jsx(je,{className:"h-4 w-4"}),"이전"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(h,10)},(s,l)=>{const m=l+1,O=m===x;return e.jsx(w,{variant:O?"default":"outline",size:"sm",onClick:()=>n==null?void 0:n(m),className:"w-10",children:m},m)})}),e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>n==null?void 0:n(x+1),disabled:x>=h,children:["다음",e.jsx(ge,{className:"h-4 w-4"})]})]}),v&&e.jsx(be,{board:a,open:p,onOpenChange:r,onSettingsUpdate:U})]})}const F={notice:{id:"1",name:"공지사항",slug:"notice",type:"notice",description:"중요한 공지사항을 확인하세요",settings:{allow_anonymous:!1,require_approval:!1,allow_comments:!0,allow_attachments:!0,max_attachment_size:10485760},sort_order:1,is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},qna:{id:"2",name:"Q&A",slug:"qna",type:"qna",description:"궁금한 점을 문의하세요",settings:{allow_anonymous:!0,require_approval:!1,allow_comments:!0,allow_attachments:!0,max_attachment_size:10485760},sort_order:2,is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},review:{id:"3",name:"제품 리뷰",slug:"review",type:"review",description:"제품 사용 후기를 공유하세요",settings:{allow_anonymous:!1,require_approval:!0,allow_comments:!0,allow_attachments:!0,max_attachment_size:10485760},sort_order:3,is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},general:{id:"4",name:"자유게시판",slug:"general",type:"general",description:"자유롭게 소통하는 공간",settings:{allow_anonymous:!0,require_approval:!1,allow_comments:!0,allow_attachments:!0,max_attachment_size:10485760},sort_order:4,is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}},G={notice:[{id:"1",board_id:"1",title:"JP Caster 신제품 출시 안내",content:`안녕하세요. JP Caster입니다.

2025년 신제품 라인업을 소개합니다.`,excerpt:"2025년 신제품 라인업을 소개합니다.",status:"published",post_type:"pinned",is_pinned:!0,views:156,likes:23,author_name:"JP Caster 관리자",is_answered:!1,created_at:"2025-01-15T10:00:00Z",updated_at:"2025-01-15T10:00:00Z"}],qna:[{id:"2",board_id:"2",title:"AGV 캐스터 하중 문의",content:"AGV 캐스터 중에서 500kg 이상 하중을 견딜 수 있는 제품이 있나요?",excerpt:"고하중 AGV 캐스터 문의",status:"published",post_type:"normal",is_pinned:!1,views:34,likes:2,author_name:"김철수",is_answered:!0,created_at:"2025-01-14T15:30:00Z",updated_at:"2025-01-14T15:30:00Z"}],review:[{id:"3",board_id:"3",title:"폴리우레탄 휠 사용 후기",content:"저소음 폴리우레탄 휠을 구매해서 사용 중입니다. 정말 소음이 많이 줄어들었어요.",excerpt:"저소음 효과 만족",status:"published",post_type:"normal",is_pinned:!1,views:67,likes:12,author_name:"이영희",is_answered:!1,created_at:"2025-01-13T09:45:00Z",updated_at:"2025-01-13T09:45:00Z"}],general:[]};function Te(){const{boardSlug:a}=se(),[d,j]=ae(),x=Q(),[y,i]=u.useState(null),[g,n]=u.useState([]),[t,S]=u.useState(0),[_,f]=u.useState(!0),[o,p]=u.useState(null),[r,k]=u.useState(!1),h=parseInt(d.get("page")||"1",10),v=d.get("search")||"";u.useEffect(()=>{A()},[a,h,v]);const A=async()=>{var N;if(!a){p("게시판을 찾을 수 없습니다."),f(!1);return}try{f(!0),p(null),k(!1);const c=await b.getBoard(a);if(!c)throw new Error("게시판을 찾을 수 없습니다.");i(c);const{posts:L,totalCount:T}=await b.getPosts(a,h,20,v||void 0);n(L),S(T)}catch(c){console.error("Board data loading error:",c),a&&F[a]?(console.log("Using fallback data for board:",a),i(F[a]),n(G[a]||[]),S(((N=G[a])==null?void 0:N.length)||0),k(!0),p(null)):p(c.message||"데이터를 불러오는데 실패했습니다.")}finally{f(!1)}},z=N=>{const c=new URLSearchParams(d);N?c.set("search",N):c.delete("search"),c.set("page","1"),j(c)},q=N=>{const c=new URLSearchParams(d);c.set("page",N.toString()),j(c)},D=()=>{x("/board")};return _?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(fe,{className:"mx-auto"})}):o||!y?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"오류 발생"}),e.jsx("p",{className:"text-gray-600 mb-6",children:o||"게시판을 찾을 수 없습니다."}),e.jsxs(w,{onClick:D,children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"게시판 목록으로"]})]})}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs(w,{variant:"ghost",size:"sm",onClick:D,children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"게시판 목록"]}),r&&e.jsx("div",{className:"text-sm text-orange-600 bg-orange-50 px-3 py-1 rounded-md",children:"오프라인 모드 - 캐시된 데이터 표시 중"})]}),e.jsx(Se,{board:y,posts:g,totalCount:t,currentPage:h,loading:_,searchQuery:v,onSearch:z,onPageChange:q})]})}export{Te as default};
